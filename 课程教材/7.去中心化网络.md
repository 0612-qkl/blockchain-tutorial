第7部分 去中心化网络
============

> 作者:彭劲  版权所有,转自请注明来源

# 为什么需要实现网络

经过前面的学习我们模拟的比特系统已经完成了区块链数据结构原型,工作量证明,UTXO交易,比特币地址和数字签名,并且优化了UTXO的交易机制。这些已经可以充分说明比特币核心技术大部分原理了,但前面完成的工作使得我们的比特币系统是"单节点"的,我们只有实现了网络才能更好地发挥前面工作实现的特性。这部分实现起来代码量相对较大,且与真正的比特币系统中的p2p网络实现是有差距的,但它有利于你对比特币网络技术的了解,并且为后面更好地学习以太坊网路奠定基础。
> 这部分的模拟实现代码需要使用到golang标准库中到http包实现网络,因此我们需要在实现之前先了解一下如何使用http包实现网络的3种基本方式

# 使用http标准库实现网络

在golang中实现网络需要导入`net/http`包,该包中的如下接口完成用户的请求和响应工作:

* `http.ResponseWriter` 这是一个接口,主要用于完成对用户的响应工作
* `http.Request` 这是一个结构体主要用于获取用户的相关请求

## 实现方式1:通过自定义请求路由来实现网络

当用户请求`http://localhost:8080/blc`这个URL时`:8080`是请求的网络端口,`/blc`是请求URL的一个路由地址,不同的路由地址可以负责不同的响应逻辑

```go
package main
import (
	"fmt"
	"net/http"
)
//定义路由
func handler(w http.ResponseWriter,r *http.Request){
	fmt.Fprintln(w,"Hello BlockChainer",r.URL.Path)
}
func main(){
	//处理请求路由
	http.HandleFunc("/blc",handler)
	//启动服务器请求端口
	http.ListenAndServe(":8080",nil)
}
```

`http.HandleFunc("/blc",handler)` 接收到路由地址`/blc`后进行逻辑处理,第2个参数接收的便是处理的逻辑,其类型为`func (w http.ResponseWriter,r *http.Request)`,因此我们自定义了路由的处理逻辑如下:

```go
//定义路由
func handler(w http.ResponseWriter,r *http.Request){
	fmt.Fprintln(w,"Hello BlockChainer",r.URL.Path)
}
```

使用`http.ResponseWriter`进行请求后的响应,`fmt.Fprintln`进行输出响应的时候需要使用到该接口,`http.Request`负责请求,通常是一个指针类型用于确保在请求时节省资源的开销
